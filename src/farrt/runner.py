import random
from matplotlib import pyplot as plt

import numpy as np

from shapely.geometry import Polygon, Point, MultiPoint

from farrt.PartiallyObservablePlanner import PartiallyObservablePlanner
from farrt.node import Node
from farrt.plot import plot_point, plot_world
from farrt.world import World

obj = object()
def main(Planner, obstacle_str=obj, start_pt=obj, goal_pt=obj, *args, **kwargs):
  """
  The main function of the farrt package.

  Parameters
  ----------
  Planner : Planner
    The planner to use.
  *args : list
    The arguments to pass to the planner.
  **kwargs : dict
    The keyword arguments to pass to the planner.

  Returns
  -------
  None
  """
  OBSTACLE_STR = "MULTIPOLYGON (((92.13434592396001 99.93534659759773, 100 99.93534659759773, 100 79.23638382159137, 89.71360196172299 79.23638382159137, 89.71360196172299 90.34847855383174, 90.90518943296799 90.34847855383174, 90.90518943296799 92.28732317911123, 92.13434592396001 92.28732317911123, 92.13434592396001 99.93534659759773)), ((90.53910059240175 60.51463843784828, 91.39832430844491 60.51463843784828, 91.39832430844491 50.15036697841296, 90.65232158329141 50.15036697841296, 90.65232158329141 42.26732229350446, 80.91721892863133 42.26732229350446, 80.91721892863133 42.148443078707835, 76.70389672595716 42.148443078707835, 76.70389672595716 46.36176528138201, 80.53273584198013 46.36176528138201, 80.53273584198013 52.38690803481575, 81.0340528490096 52.38690803481575, 81.0340528490096 57.224277743867866, 78.92018598530305 57.224277743867866, 78.92018598530305 66.50745881469865, 88.20336705613383 66.50745881469865, 88.20336705613383 61.44860926871449, 90.53910059240175 61.44860926871449, 90.53910059240175 60.51463843784828)), ((0.0561551034146603 33.12617953472854, 0.0561551034146603 43.98910195235501, 10.919077521041128 43.98910195235501, 10.919077521041128 33.12617953472854, 0.0561551034146603 33.12617953472854)), ((6.95366757052008 61.53474047825313, 6.95366757052008 54.154295249724406, 0 54.154295249724406, 0 65.9115216659334, 5.888326695242592 65.9115216659334, 5.888326695242592 72.41628435740046, 7.404887258680992 72.41628435740046, 7.404887258680992 74.99226544374812, 17.54785332546468 74.99226544374812, 17.54785332546468 69.4174355463633, 20.310034682744757 69.4174355463633, 20.310034682744757 66.44188215557705, 20.68863615416013 66.44188215557705, 20.68863615416013 76.48344699221815, 31.422218534758407 76.48344699221815, 31.422218534758407 71.89941049904444, 35.702894255542844 71.89941049904444, 35.702894255542844 75.32540651341867, 45.57367463054702 75.32540651341867, 45.57367463054702 79.32303463621732, 41.20779063683537 79.32303463621732, 41.20779063683537 82.34805673080093, 37.86093772243169 82.34805673080093, 37.86093772243169 88.78968846307676, 44.302569454707516 88.78968846307676, 44.302569454707516 86.25170694778102, 48.13646294839907 86.25170694778102, 48.13646294839907 82.12005946554623, 52.54948356944503 82.12005946554623, 52.54948356944503 75.14425052664822, 46.1036644364564 75.14425052664822, 46.1036644364564 64.92463633250512, 42.90785127153779 64.92463633250512, 42.90785127153779 61.805079585281604, 52.35712892215048 61.805079585281604, 52.35712892215048 50.55832042909847, 41.11036976596735 50.55832042909847, 41.11036976596735 60.1836073207149, 35.63209279159972 60.1836073207149, 35.63209279159972 53.41604113029422, 33.30531713477577 53.41604113029422, 33.30531713477577 46.66376219347993, 28.240985207522463 46.66376219347993, 28.240985207522463 43.284273522351185, 28.73634179669552 43.284273522351185, 28.73634179669552 34.04583263606703, 28.21127564114813 34.04583263606703, 28.21127564114813 30.324667226560244, 19.739800031831205 30.324667226560244, 19.739800031831205 32.35828744502674, 14.724544936862724 32.35828744502674, 14.724544936862724 42.390897749319244, 16.250133889908845 42.390897749319244, 16.250133889908845 49.09224196671022, 20.828116539455202 49.09224196671022, 20.828116539455202 49.870906226626, 14.283829547438373 49.870906226626, 14.283829547438373 56.84020501718304, 12.692478292652751 56.84020501718304, 12.692478292652751 61.53474047825313, 6.95366757052008 61.53474047825313), (19.633310078402104 62.15617040917372, 19.633310078402104 63.09412112496258, 16.769870574389927 63.09412112496258, 16.769870574389927 62.395015833911174, 18.247289109380883 62.395015833911174, 18.247289109380883 57.17932420723751, 18.371660054493237 57.17932420723751, 18.371660054493237 62.15617040917372, 19.633310078402104 62.15617040917372), (25.423510087410833 65.07509885622484, 31.192048093208253 65.07509885622484, 31.192048093208253 65.74986461161987, 25.423510087410833 65.74986461161987, 25.423510087410833 65.07509885622484)), ((97.95297384161728 23.46663675699757, 90.96904895129768 23.46663675699757, 90.96904895129768 30.450561647317176, 97.95297384161728 30.450561647317176, 97.95297384161728 23.46663675699757)), ((64.34822791223566 73.09179703896163, 64.34822791223566 63.09354747628283, 54.349978349556864 63.09354747628283, 54.349978349556864 73.09179703896163, 64.34822791223566 73.09179703896163)), ((6.8691953197884725 18.94578806921499, 6.8691953197884725 29.29181317872515, 17.215220429298633 29.29181317872515, 17.215220429298633 18.94578806921499, 6.8691953197884725 18.94578806921499)), ((66.18884386134079 6.043731719502158, 57.05401477801564 6.043731719502158, 57.05401477801564 14.515753856734735, 55.994327887429364 14.515753856734735, 55.994327887429364 20.792079552376006, 59.51054343838452 20.792079552376006, 59.51054343838452 21.506381600990295, 70.42617080514593 21.506381600990295, 70.42617080514593 10.590754234228891, 68.75271087602711 10.590754234228891, 68.75271087602711 9.904320528876987, 66.18884386134079 9.904320528876987, 66.18884386134079 6.043731719502158)), ((33.291636755611485 99.62828486016858, 33.291636755611485 94.6021495120321, 28.265501407475014 94.6021495120321, 28.265501407475014 99.62828486016858, 33.291636755611485 99.62828486016858)), ((55.96761985862757 87.27869641129755, 47.8893286175861 87.27869641129755, 47.8893286175861 88.00064942474776, 47.52032625227615 88.00064942474776, 47.52032625227615 95.95962766838912, 55.4793044959175 95.95962766838912, 55.4793044959175 95.356987652339, 55.96761985862757 95.356987652339, 55.96761985862757 87.27869641129755)), ((34.22881736634313 36.25006823620651, 34.22881736634313 40.55718105925224, 38.01789440711745 40.55718105925224, 38.01789440711745 42.54494859657529, 49.847899122346234 42.54494859657529, 49.847899122346234 32.35416222664921, 50.308721625587665 32.35416222664921, 50.308721625587665 27.84041984500377, 45.79497924394222 27.84041984500377, 45.79497924394222 30.714943881346507, 42.94241878944083 30.714943881346507, 42.94241878944083 24.38521251957043, 31.65253147705709 24.38521251957043, 31.65253147705709 35.67509983195417, 38.01789440711745 35.67509983195417, 38.01789440711745 36.25006823620651, 34.22881736634313 36.25006823620651)), ((100 57.39439269423417, 100 45.414475902095724, 94.40243332699076 45.414475902095724, 94.40243332699076 50.44594317233789, 93.2115984065571 50.44594317233789, 93.2115984065571 57.39439269423417, 100 57.39439269423417)), ((42.82027339054051 99.11279476056035, 42.82027339054051 92.8677920276669, 36.57527065764705 92.8677920276669, 36.57527065764705 96.42573685793697, 35.5321498808312 96.42573685793697, 35.5321498808312 100, 41.57012275746574 100, 41.57012275746574 99.11279476056035, 42.82027339054051 99.11279476056035)), ((30.9266578351372 18.79198443357236, 38.86214980468343 18.79198443357236, 38.86214980468343 10.856492464026125, 30.9266578351372 10.856492464026125, 30.9266578351372 18.79198443357236)), ((74.02065629689947 5.867409018787992, 75.22247250387662 5.867409018787992, 75.22247250387662 9.442659930963208, 86.01723759114641 9.442659930963208, 86.01723759114641 10.041827589660306, 91.298423316475 10.041827589660306, 91.298423316475 6.845579067256157, 91.60829003911171 6.845579067256157, 91.60829003911171 0, 74.02065629689947 0, 74.02065629689947 5.867409018787992)), ((56.11462662573892 90.2653818325187, 56.11462662573892 95.02149788398759, 60.870742677207815 95.02149788398759, 60.870742677207815 90.2653818325187, 56.11462662573892 90.2653818325187)), ((0 47.109900343149036, 0 53.55617562386516, 4.689943047215472 53.55617562386516, 4.689943047215472 47.109900343149036, 0 47.109900343149036)), ((22.56257885253188 2.9438727010665855, 22.56257885253188 7.796796840549314, 27.41550299201461 7.796796840549314, 27.41550299201461 2.9438727010665855, 22.56257885253188 2.9438727010665855)), ((11.771082369214417 10.81495724384394, 11.771082369214417 7.158712962458129, 12.599336167341217 7.158712962458129, 12.599336167341217 0, 4.294306413964994 0, 4.294306413964994 7.158712962458129, 5.058207645012223 7.158712962458129, 5.058207645012223 10.81495724384394, 11.771082369214417 10.81495724384394)), ((60.93215914842989 49.69888101505586, 60.93215914842989 48.091010459867505, 68.02661266211776 48.091010459867505, 68.02661266211776 45.55640655607607, 68.55593219227923 45.55640655607607, 68.55593219227923 34.62726866189878, 57.626794298101935 34.62726866189878, 57.626794298101935 36.378249161998966, 56.3138513642492 36.378249161998966, 56.3138513642492 48.091010459867505, 56.67663244986612 48.091010459867505, 56.67663244986612 49.69888101505586, 60.93215914842989 49.69888101505586)), ((17.946891051930546 27.70958749074617, 25.242986838752213 27.70958749074617, 25.242986838752213 25.10249014516613, 28.30037613820206 25.10249014516613, 28.30037613820206 17.440408770073105, 20.638294763109037 17.440408770073105, 20.638294763109037 20.413491703924503, 17.946891051930546 20.413491703924503, 17.946891051930546 27.70958749074617)), ((17.871225104350223 81.96812586093445, 17.871225104350223 77.67056449875018, 13.57366374216595 77.67056449875018, 13.57366374216595 81.96812586093445, 17.871225104350223 81.96812586093445)), ((38.11686890895794 4.465557800837756, 44.130961983270396 4.465557800837756, 44.130961983270396 0, 38.11686890895794 0, 38.11686890895794 4.465557800837756)), ((7.6620102160440915 100, 19.530025361472923 100, 19.530025361472923 88.97396574248755, 7.6620102160440915 88.97396574248755, 7.6620102160440915 100)))"

  if obstacle_str is not obj:
    OBSTACLE_STR = obstacle_str

  world = World(obstacle_str=OBSTACLE_STR)
  print(world.obstacles)

  start = Point(76.3774618976614, 25.50690257394217)
  goal = Point(65.15929727227629, 78.87233511355132)

  if start_pt is not obj:
    start = start_pt
  if goal_pt is not obj:
    goal = goal_pt


  random.seed(1)
  np.random.seed

  if OBSTACLE_STR is None:
    fig,ax = plot_world(world)
    start = world.random_position(not_blocked=True)
    goal = world.random_position(not_blocked=True)
    plot_point(ax, start, marker=".", markersize=6, markeredgecolor="red", markerfacecolor="red")
    plot_point(ax, goal, marker=".", markersize=6, markeredgecolor="green", markerfacecolor="green")
    plt.show()

  print(f'Start: {start} -> Goal: {goal}')

  planner: PartiallyObservablePlanner = Planner(world=world, x_start=Node(start), x_goal=Node(goal), gui=True, **kwargs)
  planner.run()
  return None